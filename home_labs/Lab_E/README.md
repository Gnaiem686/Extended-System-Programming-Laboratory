# Lab E – Linking ELF Object Files (myELF)

A C program that inspects **32-bit ELF** object files using `mmap` and implements a limited **linker pass I (merge)** for two relocatable objects. The tool can examine ELF headers, print section tables and symbols (similar to `readelf`), validate whether two objects can be merged, and generate a merged relocatable output file (`out.ro`).

> **Important:** This lab targets **ELF32**. Compile with `-m32` and use `Elf32_*` structures from `elf.h`.

---

## What This Lab Covers

- Parsing ELF headers and navigating file structures via offsets
- Working with the **Section Header Table** and section name string table (`.shstrtab`)
- Reading the **Symbol Table** (`.symtab`) and symbol string table (`.strtab`)
- Using `mmap` for file input (no `read` / `fread` for ELF input)
- Implementing a simplified **linker merge step**: symbol checks + section concatenation

---

## Menu Options

When you run `myELF`, you get an interactive menu:

0. Toggle Debug Mode  
1. Examine ELF File  
2. Print Section Names  
3. Print Symbols  
4. Check Files for Merge  
5. Merge ELF Files  
6. Quit  

The tool supports examining and keeping **up to two ELF files mapped at the same time**.

---

## Part 0 – Examine ELF Header (mmap)

- Open an ELF file and map the entire file with a single `mmap`.
- Verify the ELF magic and refuse non-ELF files.
- Print important header fields (in the exact order requested by the lab), including:
  - Magic bytes
  - Data encoding
  - Entry point
  - Section header table offset + count + entry size
  - Program header table offset + count + entry size

---

## Part 1 – Print Section Names

For each mapped ELF file, print all section headers similar to `readelf -S`:

- index
- section name
- address
- offset
- size
- type

Section names are resolved through the **section header string table** (`.shstrtab`).

---

## Part 2 – Print Symbols

For each mapped ELF file, print symbol information similar to `readelf -s`:

- symbol index
- value
- section index
- section name
- symbol name

Symbol names are resolved through the **symbol string table** (`.strtab`).

---

## Part 3 – Linker Pass I (Merge)

### 3.1 Check Files for Merge
Validates merge compatibility for exactly two ELF files (each containing exactly one symbol table):

- If a symbol is **UNDEFINED** in file 1:
  - Must exist and be defined in file 2, otherwise: `Symbol <name> undefined`
- If a symbol is defined in file 1:
  - Must not be defined in file 2, otherwise: `Symbol <name> multiply defined`

> The scan continues even after errors are found.

### 3.2 Merge ELF Files
Creates a merged relocatable output file `out.ro`:

- Start from a copy of ELF header + section headers of file 1
- Concatenate mergeable sections:
  - `.text`, `.data`, `.rodata`
- Reuse tables as-is (per lab assumptions):
  - `.shstrtab`, `.symtab` (and relocation sections, if applicable)
- Resolve undefined symbols in file 1 using definitions from file 2
- Write sections and the new section header table to `out.ro`
- Update `e_shoff` to point to the new section header table

With the lab’s restrictions, the resulting `out.ro` should be valid for inspection with `readelf`.  
**Bonus:** linking `out.ro` with `ld` can produce a runnable executable in supported cases.

---

## Build

```bash
make
```

If you compile manually, ensure **32-bit** mode:

```bash
gcc -m32 -Wall -Wextra -g myELF.c -o myELF
```

> On some 64-bit systems you may need 32-bit dev libraries installed.

---

## Run

```bash
./myELF
```

Use **Examine ELF File** to load up to 2 object files, then print sections/symbols, check merge, and merge.

---

## Useful Debug Tools

- `readelf -h/-S/-s <file>` (compare output)
- `file <file>` (confirm 32-bit vs 64-bit)
- `hexedit <file>` (spot-check offsets during debugging)

In **Debug Mode**, it’s recommended to print important offsets/indices such as:
- `e_shoff`, `e_shnum`, `e_shentsize`
- section name table index `e_shstrndx`
- symbol table size and number of symbols

---

## Output

- `out.ro` – merged relocatable object file generated by the Merge option

---

## License

Educational / course assignment use.
